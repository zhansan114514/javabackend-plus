# 后端任务板块

相信你是从前端板块过来的呀，如果不是，要么你是有基础或者你是看错了不知道应该先完成前端的板块。我们这里是与机器信息后端交互，返还给后端需要的摄像头信息，比如摄像头列表，还有摄像头检测区域时间类别，并且很重要的是，会得到后端发送过来的报警信息，检测到嫌疑犯了！

## task4摄像头业务

任务中的接口都定义在mlBackend包下的getInfoController(这里取名字稍微有点不合理)

### 4.1实现所有摄像头检测区域、时间、类别接口（这只是一个接口，一个函数）

对应在apifox里面有写，注意查看喔！

这次需要你自己来完全实现，你需要按照apifox上的定义形式以及参考响应示例来给出答案。

### 4.2假的任务

这个任务不需要写你写太多代码，只是让你思考，apifox里面明明有两个![image-20230802173048431](https://fastly.jsdelivr.net/gh/KMSorSMS/picGallery/img/202308021751535.png)接口是摄像头的业务，但是我说那个摄像头列表任务不需要做，只要我们用原本在前端业务的  “摄像头获得的接口“就好了，你可以想想是不是，并看看该如何进行接口调用就OK啦(写接口调用的部分的代码)！

## task5报警业务

任务中的接口都定义在mlBackend包下的AlertTransactionController里面

这里我们是要获得后端发送过来的报警信息，我们将报警信息部分存入数据库的alert表中，由于同一个报警信息有两次发送，第一次发送图片，第二次发送视频，至于这是为什么，就让我把前面前端部分的README的内容复制过来解释一下：

> 后端机器学习部分检测到嫌疑犯，就会向服务器发送检测到嫌疑犯的图片，以及是哪个摄像头（ca_id）在什么时间(alert_time)检测到嫌疑犯是什么类型的犯罪（type），只要是ca_id alert_time type组合起来是不同的，就说明这是一条不同的报警信息，就不算做重复，需要按照alertType/alertTimeString-caIdString.jpg这样的格式存储到photoSource路径下面，而这个时候报警视频还没有传过来，因为后端还会等一会儿，所以这里会分成两个接口![image-20230802155650824](https://fastly.jsdelivr.net/gh/KMSorSMS/picGallery/img/202308021620539.png)对应着不同的环节，后面报警视频上传的时候，我们从apifox里面也能看到，警报信息和视频上传的请求格式都是form-data了，因为这样能直接上传二进制文件，然后我们要先检查报警视频对应的报警信息部分是否是已经存在的，因为必须要存在你这个视频才能传输上去，然后在再接收这个报警视频，并且更新数据库表的信息。

### 5.1实现报警信息上传接口---AlertInfo

这里我们的难度会有提升，需要你续写代码，我的代码写到接收完请求参数的控制层就结束了，剩下的将报警信息存到数据库，将报警图片存到服务器本地需要你自己完成，这里给一点存储到本地可以使用的MultipartFile中方法的建议：

```java
void transferTo(File dest)
```

这是我将从请求中的二进制图片alertPhoto存到本地pathPhoto路径的操作，其中dest为保存路径位置。

### 5.2实现报警视频上传接口---AlertVideo

这个接口完全就是上面接口的重复了，只是逻辑上稍微不同，上面接口会检验报警信息重复了没有，但是这里的接口会检验报警信息是否存在，因为同一条信息是有报警图片（信息）和报警视频的，而视频一定在图片后，并且只是更新数据库alert表中对应报警信息的path_video字段。这里就是唯一要注意的，视频上传与数据库路径更新是需要同步的(同时成功/失败)，还不要忘记了视频同样是要保存到服务器，前端后来会访问的哦！
